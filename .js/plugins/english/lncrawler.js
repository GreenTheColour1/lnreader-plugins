var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,c){function i(e){try{s(r.next(e))}catch(e){c(e)}}function a(e){try{s(r.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}s((r=r.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var n,r,o,c,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return c={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function a(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,a[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:0};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:1}}([a,s])}}};Object.defineProperty(exports,"__esModule",{value:1});var n=require("@libs/fetch"),r=require("@libs/filterInputs"),o=require("@libs/novelStatus"),c=function(){function c(){this.id="lncrwaler",this.name="Lncrawler",this.icon="src/en/lncrawler/logo.png",this.site="https://ln.camerongreen.ca",this.version="0.1.0",this.filters={order:{label:"Order",options:[{label:"All time",value:"rank"},{label:"Rating",value:"rating"},{label:"Weekly",value:"weekly_views"}],type:r.FilterTypes.Picker,value:""}}}return c.prototype.popularNovels=function(r,o){var c=o.showLatestNovels,i=o.filters;return e(this,void 0,void 0,(function(){var e,o,a,s;return t(this,(function(t){switch(t.label){case 0:return e=[],o="",o=c?this.site+"/api/sources?page=".concat(r-1,"&sort=last_updated&number=10"):this.site+"/api/novels?page=".concat(r-1,"&sort=").concat(i.order.value,"&number=10"),[4,(0,n.fetchApi)(o).then((function(e){return e.json()}))];case 1:for(a=t.sent(),s=1;s<10;s++)"".concat(s)in a.content&&e.push({name:a.content["".concat(s)].title,path:this.site+"/api/novel?novel=".concat(a.content["".concat(s)].slug,"&source=").concat(a.content["".concat(s)].prefered_source),cover:this.site+"/api/image/"+a.content["".concat(s)].cover});return[2,e]}}))}))},c.prototype.parseNovel=function(r){return e(this,void 0,void 0,(function(){var e,c,i,a,s,u,l,h,p=this;return t(this,(function(t){switch(t.label){case 0:return e={path:r,name:"Untitled"},[4,(0,n.fetchApi)(r).then((function(e){return e.json()}))];case 1:return c=t.sent(),e.name=c.title,e.artist="",e.author=c.author,e.cover=this.site+"/api/image/"+c.cover,e.genres=c.tags.toString(),e.status=o.NovelStatus.Ongoing,e.summary=c.summary,i=[],a="/api/chapterlist/?novel=".concat(c.novel.slug,"&source=").concat(c.novel.prefered_source,"&page=1"),[4,(0,n.fetchApi)(this.site+a).then((function(e){return e.json()}))];case 2:if(s=t.sent(),u=s.total_pages,s.content.forEach((function(e){var t={name:e.title,path:p.site+"/api/chapter/?novel=".concat(c.novel.slug,"&source=").concat(c.novel.prefered_source,"&chapter=").concat(e.id),chapterNumber:e.id};i.push(t)})),!(u>1))return[3,6];l=2,t.label=3;case 3:return l<u?(h="/api/chapterlist/?novel=".concat(c.novel.slug,"&source=").concat(c.novel.prefered_source,"&page=").concat(l),[4,(0,n.fetchApi)(this.site+h).then((function(e){return e.json()}))]):[3,6];case 4:t.sent().content.forEach((function(e){var t={name:e.title,path:p.site+"/api/chapter/?novel=".concat(c.novel.slug,"&source=").concat(c.novel.prefered_source,"&chapter=").concat(e.id),chapterNumber:e.id};i.push(t)})),t.label=5;case 5:return l++,[3,3];case 6:return e.chapters=i,[2,e]}}))}))},c.prototype.parseChapter=function(r){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,(0,n.fetchApi)(r).then((function(e){return e.json()}))];case 1:return e=t.sent(),[2,e.content.body]}}))}))},c.prototype.searchNovels=function(r,o){return e(this,void 0,void 0,(function(){var e,o=this;return t(this,(function(t){switch(t.label){case 0:return e=[],[4,(0,n.fetchApi)(this.site+"/api/search?query=".concat(r)).then((function(e){return e.json()}))];case 1:return t.sent().content.forEach((function(t){e.push({name:t.title,path:o.site+"/api/novel?novel=".concat(t.slug,"&source=").concat(t.prefered_source),cover:o.site+"/api/image/"+t.cover})})),[2,e]}}))}))},c.prototype.fetchImage=function(r){return e(this,void 0,void 0,(function(){return t(this,(function(e){return[2,(0,n.fetchFile)(r)]}))}))},c}();exports.default=new c;